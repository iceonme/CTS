(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5725:function(e,t,a){Promise.resolve().then(a.bind(a,772))},772:function(e,t,a){"use strict";a.d(t,{default:function(){return c}});var n=a(7437),o=a(2265),i=a(8027);class r{createInitialPortfolio(){return{initialBalance:1e4,balance:1e4,totalEquity:1e4,totalUnrealizedPnl:0,totalRealizedPnl:0,totalReturn:0,totalReturnPercent:0,positions:[],trades:[],updatedAt:new Date}}saveToStorage(){localStorage.setItem("cts_portfolio",JSON.stringify(this.portfolio))}loadFromStorage(){{let e=localStorage.getItem("cts_portfolio");if(e)try{let t=JSON.parse(e);t.positions=t.positions.map(e=>({...e,openedAt:new Date(e.openedAt),lastUpdated:new Date(e.lastUpdated)})),t.trades=t.trades.map(e=>({...e,createdAt:new Date(e.createdAt)})),t.updatedAt=new Date(t.updatedAt),this.portfolio=t}catch(e){console.error("[Portfolio] Failed to load from storage",e)}}}getPortfolio(){return{...this.portfolio}}updatePrice(e,t){this.currentPrices.set(e,t),this.updatePositions()}updatePrices(e){Object.entries(e).forEach(e=>{let[t,a]=e;this.currentPrices.set(t,a)}),this.updatePositions()}executeTrade(e){let{symbol:t,side:a,type:n,quantity:o,price:i,notes:r}=e;if(o<=0)return{success:!1,error:"数量必须大于0"};let l=i||this.currentPrices.get(t);if(!l)return{success:!1,error:"无法获取 ".concat(t," 的当前价格")};let s="market"===n?l:i,c=s*o,d=.001*c,u=c+d;if("buy"===a&&u>this.portfolio.balance)return{success:!1,error:"资金不足"};let p=this.portfolio.positions.find(e=>e.symbol===t&&"long"===e.side);if("sell"===a&&(!p||p.quantity<o))return{success:!1,error:"持仓不足"};let f={id:"trade-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),symbol:t,side:a,type:n,quantity:o,price:s,total:c,fee:d,relatedPositionId:null==p?void 0:p.id,createdAt:new Date,notes:r};if("sell"===a&&p){let e=p.avgPrice*o;f.realizedPnl=c-e-d,f.realizedPnlPercent=f.realizedPnl/e*100,this.portfolio.totalRealizedPnl+=f.realizedPnl}if("buy"===a){if(p){let e=p.avgPrice*p.quantity,t=p.quantity+o;p.avgPrice=(e+c)/t,p.quantity=t,p.lastUpdated=new Date}else{let e={id:"pos-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),symbol:t,side:"long",quantity:o,avgPrice:s,currentPrice:s,unrealizedPnl:0,unrealizedPnlPercent:0,openedAt:new Date,lastUpdated:new Date};this.portfolio.positions.push(e)}this.portfolio.balance-=u}else p&&(p.quantity===o?this.portfolio.positions=this.portfolio.positions.filter(e=>e.id!==p.id):(p.quantity-=o,p.lastUpdated=new Date)),this.portfolio.balance+=c-d;return this.portfolio.trades.unshift(f),this.portfolio.trades.length>100&&(this.portfolio.trades=this.portfolio.trades.slice(0,100)),this.updatePortfolioStats(),this.saveToStorage(),{success:!0,trade:f}}updatePositions(){let e=0;this.portfolio.positions.forEach(t=>{let a=this.currentPrices.get(t.symbol);if(a){t.currentPrice=a;let n=t.currentPrice*t.quantity,o=t.avgPrice*t.quantity;t.unrealizedPnl=n-o,t.unrealizedPnlPercent=t.unrealizedPnl/o*100,e+=t.unrealizedPnl}}),this.portfolio.totalUnrealizedPnl=e,this.updatePortfolioStats()}updatePortfolioStats(){let e=this.portfolio.positions.reduce((e,t)=>e+t.currentPrice*t.quantity,0);this.portfolio.totalEquity=this.portfolio.balance+e,this.portfolio.totalReturn=this.portfolio.totalRealizedPnl+this.portfolio.totalUnrealizedPnl,this.portfolio.totalReturnPercent=this.portfolio.totalReturn/this.portfolio.initialBalance*100,this.portfolio.updatedAt=new Date}getPosition(e){return this.portfolio.positions.find(t=>t.symbol===e)}getPositions(){return[...this.portfolio.positions]}getTrades(e){let t=[...this.portfolio.trades];return e?t.slice(0,e):t}reset(){this.portfolio=this.createInitialPortfolio(),this.currentPrices.clear(),this.saveToStorage()}getStats(){let e=this.portfolio.trades.filter(e=>void 0!==e.realizedPnl),t=e.filter(e=>(e.realizedPnl||0)>0),a=e.filter(e=>0>(e.realizedPnl||0)),n=t.reduce((e,t)=>e+(t.realizedPnl||0),0),o=Math.abs(a.reduce((e,t)=>e+(t.realizedPnl||0),0));return{totalTrades:e.length,winningTrades:t.length,losingTrades:a.length,winRate:e.length>0?t.length/e.length*100:0,avgWin:t.length>0?n/t.length:0,avgLoss:a.length>0?o/a.length:0,profitFactor:o>0?n/o:n>0?1/0:0}}constructor(){this.currentPrices=new Map,this.portfolio=this.createInitialPortfolio(),this.loadFromStorage()}}let l=null;function s(){return l||(l=new r),l}function c(){let[e,t]=(0,o.useState)([{id:"welcome",role:"cfo",content:"**\uD83D\uDC54 CFO 智能助手**\n\n您好，我是您的加密资产 CFO。我可以帮您：\n\n\uD83D\uDCCA **市场分析** - 分析 BTC、DOGE 等币种\n\uD83C\uDF0D **市场概览** - 查看整体市场状况  \n\uD83D\uDCB0 **交易执行** - 模拟交易操作\n\uD83D\uDCC8 **盈亏查询** - 查看投资组合\n\n请直接输入您想了解的内容。",timestamp:new Date}]),[a,r]=(0,o.useState)(""),[l,c]=(0,o.useState)(!1),d=(0,o.useRef)(null),u=()=>{var e;null===(e=d.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,o.useEffect)(()=>{u()},[e]);let p=async()=>{if(!a.trim()||l)return;let e={id:"user-".concat(Date.now()),role:"user",content:a,timestamp:new Date};t(t=>[...t,e]),r(""),c(!0);try{let e=await f(a),n={id:"cfo-".concat(Date.now()),role:"cfo",content:e.content,timestamp:new Date,metadata:e.metadata};t(e=>[...e,n])}catch(a){let e={id:"error-".concat(Date.now()),role:"system",content:"抱歉，处理请求时出现错误，请稍后再试。",timestamp:new Date};t(t=>[...t,e])}finally{c(!1)}},f=async e=>{let t=e.toLowerCase(),a=(0,i.ps)();if(s(),t.includes("买入")||t.includes("buy")){let t=e.match(/(买入|buy)\s*(\w+)\s*(\d*\.?\d*)/i);if(t)return h(t[2].toUpperCase(),"buy",parseFloat(t[3])||100)}if(t.includes("卖出")||t.includes("sell")){let t=e.match(/(卖出|sell)\s*(\w+)\s*(\d*\.?\d*)/i);if(t)return h(t[2].toUpperCase(),"sell",parseFloat(t[3])||0)}if(t.includes("持仓")||t.includes("position")||t.includes("portfolio"))return x();if(t.includes("历史")||t.includes("history")||t.includes("交易记录"))return m();if(t.includes("市场")||t.includes("market")||t.includes("概览")){let e=await a.getMarketOverview();return{content:a.formatMarketOverview(e)}}let n=e.match(/\b(BTC|DOGE|ETH|SOL)\b/i);if(n){let e=n[0].toUpperCase();try{let t=await a.analyzeSymbol(e);return{content:a.formatAnalysisForChat(t),metadata:{type:"analysis",symbol:e,confidence:t.consensus.confidence,bullConfidence:t.perspectives.bull.confidence,bearConfidence:t.perspectives.bear.confidence,action:t.consensus.action}}}catch(t){return{content:"暂时无法分析 ".concat(e,"，请稍后再试。")}}}return{content:await a.chat(e)}},h=(e,t,a)=>{let n=s(),o=a/5e4,i=n.executeTrade({symbol:e,side:t,type:"market",quantity:o,notes:"通过 CFO 对话执行"});if(!i.success||!i.trade)return{content:"❌ **交易失败**\n\n".concat(i.error)};{let a=i.trade;return{content:"✅ **交易执行成功**\n\n"+"**".concat("buy"===t?"买入":"卖出","** ").concat(e,"\n")+"数量: ".concat(o.toFixed(6),"\n")+"价格: $".concat(a.price.toLocaleString(),"\n")+"金额: $".concat(a.total.toFixed(2),"\n")+"手续费: $".concat(a.fee.toFixed(2),"\n\n")+"".concat(void 0!==a.realizedPnl?"已实现盈亏: ".concat(a.realizedPnl>=0?"+":"","$").concat(a.realizedPnl.toFixed(2)):""),metadata:{type:"trade",symbol:e}}}},x=()=>{let e=s(),t=e.getPortfolio(),a=e.getPositions(),n=e.getStats(),o="\uD83D\uDCB0 **投资组合概览**\n\n";return o+="初始资金: $".concat(t.initialBalance.toLocaleString(),"\n")+"可用资金: $".concat(t.balance.toFixed(2),"\n")+"总资产: $".concat(t.totalEquity.toFixed(2),"\n")+"总盈亏: ".concat(t.totalReturn>=0?"+":"","$").concat(t.totalReturn.toFixed(2)," (").concat(t.totalReturnPercent.toFixed(2),"%)\n\n"),a.length>0?(o+="**持仓明细:**\n",a.forEach(e=>{let t=e.unrealizedPnl>=0?"\uD83D\uDFE2":"\uD83D\uDD34";o+="".concat(t," **").concat(e.symbol,"**: ").concat(e.quantity.toFixed(6)," @ $").concat(e.avgPrice.toFixed(2),"\n")+"   现价: $".concat(e.currentPrice.toFixed(2)," | 浮动盈亏: ").concat(e.unrealizedPnl>=0?"+":"","$").concat(e.unrealizedPnl.toFixed(2)," (").concat(e.unrealizedPnlPercent.toFixed(2),"%)\n")})):o+="当前无持仓。",{content:o+="\n**交易统计:**\n"+"总交易次数: ".concat(n.totalTrades,"\n")+"胜率: ".concat(n.winRate.toFixed(1),"%\n"),metadata:{type:"report"}}},m=()=>{let e=s().getTrades(10);if(0===e.length)return{content:"暂无交易记录。"};let t="\uD83D\uDCDC **最近交易记录**\n\n";return e.forEach((e,a)=>{let n="buy"===e.side?"\uD83D\uDFE2":"\uD83D\uDD34",o=void 0!==e.realizedPnl?" | 盈亏: ".concat(e.realizedPnl>=0?"+":"","$").concat(e.realizedPnl.toFixed(2)):"";t+="".concat(a+1,". ").concat(n," **").concat("buy"===e.side?"买入":"卖出","** ").concat(e.symbol,"\n")+"   ".concat(e.quantity.toFixed(6)," @ $").concat(e.price.toFixed(2)).concat(o,"\n")+"   ".concat(e.createdAt.toLocaleString(),"\n\n")}),{content:t,metadata:{type:"report"}}};return(0,n.jsxs)("div",{className:"flex flex-col h-full bg-gray-900 rounded-lg border border-gray-800",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-800",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC54"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"font-semibold text-white",children:"CFO 智能助手"}),(0,n.jsx)("p",{className:"text-xs text-gray-400",children:"专业简洁 \xb7 数据驱动"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,n.jsx)("span",{className:"text-xs text-green-500",children:"在线"})]})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.map(e=>{var t,a,o,i;return(0,n.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-[80%] rounded-lg p-3 ".concat("user"===e.role?"bg-blue-600 text-white":"system"===e.role?"bg-gray-700 text-gray-300":"bg-gray-800 text-gray-100"),children:["cfo"===e.role&&(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)("span",{className:"text-sm",children:"\uD83D\uDC54"}),(0,n.jsx)("span",{className:"text-xs font-medium text-blue-400",children:"CFO"}),(null===(t=e.metadata)||void 0===t?void 0:t.confidence)&&(0,n.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-blue-900 rounded",children:["置信度 ",(100*e.metadata.confidence).toFixed(0),"%"]})]}),(null===(a=e.metadata)||void 0===a?void 0:a.bullConfidence)!==void 0&&(null===(o=e.metadata)||void 0===o?void 0:o.bearConfidence)!==void 0&&(0,n.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,n.jsxs)("div",{className:"flex-1 bg-green-900/50 rounded p-1 text-center",children:[(0,n.jsx)("div",{className:"text-xs text-green-400",children:"\uD83D\uDC02 Bull"}),(0,n.jsxs)("div",{className:"text-sm font-bold text-green-300",children:[(100*(e.metadata.bullConfidence||0)).toFixed(0),"%"]})]}),(0,n.jsxs)("div",{className:"flex-1 bg-red-900/50 rounded p-1 text-center",children:[(0,n.jsx)("div",{className:"text-xs text-red-400",children:"\uD83D\uDC3B Bear"}),(0,n.jsxs)("div",{className:"text-sm font-bold text-red-300",children:[(100*(e.metadata.bearConfidence||0)).toFixed(0),"%"]})]})]}),(0,n.jsx)("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",children:e.content}),(null===(i=e.metadata)||void 0===i?void 0:i.action)&&(0,n.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,n.jsx)("button",{onClick:()=>{var t;return r("买入 ".concat(null===(t=e.metadata)||void 0===t?void 0:t.symbol," 100"))},className:"px-3 py-1 text-xs bg-green-600 hover:bg-green-700 rounded",children:"买入"}),(0,n.jsx)("button",{onClick:()=>{var t;return r("卖出 ".concat(null===(t=e.metadata)||void 0===t?void 0:t.symbol))},className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-700 rounded",children:"卖出"})]}),(0,n.jsx)("div",{className:"text-right mt-1",children:(0,n.jsx)("span",{className:"text-xs opacity-50",children:e.timestamp.toLocaleTimeString()})})]})},e.id)}),l&&(0,n.jsx)("div",{className:"flex justify-start",children:(0,n.jsx)("div",{className:"bg-gray-800 rounded-lg p-3",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sm",children:"\uD83D\uDC54"}),(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),(0,n.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,n.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),(0,n.jsx)("div",{ref:d})]}),(0,n.jsx)("div",{className:"px-4 py-2 border-t border-gray-800 flex gap-2 overflow-x-auto",children:[{label:"\uD83D\uDCCA BTC分析",command:"分析 BTC"},{label:"\uD83D\uDC15 DOGE分析",command:"分析 DOGE"},{label:"\uD83D\uDCB0 持仓",command:"查看持仓"},{label:"\uD83C\uDF0D 市场概览",command:"市场概览"}].map(e=>(0,n.jsx)("button",{onClick:()=>{r(e.command)},className:"px-3 py-1.5 text-xs bg-gray-800 hover:bg-gray-700 rounded-full whitespace-nowrap transition-colors",children:e.label},e.label))}),(0,n.jsx)("div",{className:"p-4 border-t border-gray-800",children:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("input",{type:"text",value:a,onChange:e=>r(e.target.value),onKeyDown:e=>"Enter"===e.key&&p(),placeholder:"输入消息，例如：分析 BTC、买入 BTC 100、查看持仓...",className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-blue-500"}),(0,n.jsx)("button",{onClick:p,disabled:l||!a.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium transition-colors",children:"发送"})]})})]})}}},function(e){e.O(0,[27,971,117,744],function(){return e(e.s=5725)}),_N_E=e.O()}]);